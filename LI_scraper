from selenium.webdriver import ActionChains
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.common.keys import Keys
from bs4 import BeautifulSoup
import pandas as pd
import time

option = webdriver.ChromeOptions()
option.add_argument("--no-sandbox")

browser = webdriver.Chrome(r'''C:\Users\tisch\chromedriver_win32\chromedriver.exe''', chrome_options=option)

browser.get('https://www.linkedin.com/')

browser.implicitly_wait(5)
timeout = 20

elem = browser.find_element_by_name('session_key')
elem.clear()
elem.send_keys("")  
elem = browser.find_element_by_name('session_password')
elem.clear()
elem.send_keys("") 

submit = browser.find_element_by_xpath("//*[@type='submit']")

actions = ActionChains(browser)
actions.click(submit)
actions.perform()
df = pd.read_csv("customers_of_competitors.csv") #csv file with companies list
companies = df["Company"]
companies = companies.dropna()

names = []
websites = []
headquarters = []
yearfoundeds = []
companytypes = []
sizes = []
specialities = []
information = []

for company in list(companies):
    print(company)
    try:
        company_s = company.lower().replace(" ", "-")
        browser.get('https://in.linkedin.com/company/' + company_s + "/")
        print('https://in.linkedin.com/company/' + company_s + "/")
        time.sleep(10)
        soup = BeautifulSoup(browser.page_source, 'lxml')
        text = soup.text.replace("\n", "$")

        text = text.replace("  ", "")
        text = text.replace("$$", "$")
        string = text[text.find("Company details") + len("Company details") + 1: text.find("See more details about")]
        string = [s.strip() for s in string.split("$") if s.strip()]

        dictionary = {}
        for itr in range(0, len(string) - 1, 2):
            dictionary[string[itr]] = string[itr + 1]
        data = []
        data.append(company)
        main = {
            "Website": 0,
            "Headquarters": 0,
            "Company size": 0,
            "Year founded": 0,
            "Specialties": 0
        }
        for key in dictionary.keys():
            if key in main:
                main[key] = dictionary[key].replace("employees", "").strip()
        for value in main.values():
            data.append(value)

        information.append(data)
    except:
        pass

df = pd.DataFrame(information, columns=[data, 'company', 'website', 'headquarters', 'company type', 'company size', 'specialties'])
df.to_csv('', index=False, encoding='utf-8') #csv file
